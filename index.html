<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Settlement Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .form-input {
            transition: border-color 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .form-input:focus {
            outline: none;
            box-shadow: 0 0 0 2px #3b82f6;
            border-color: #3b82f6;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen py-12">

    <div class="w-full max-w-lg mx-auto p-4">
        <div class="bg-white rounded-2xl shadow-lg p-6 md:p-8">
            <header class="text-center mb-8">
                <h1 class="text-3xl font-bold text-gray-800">Settlement Calculator</h1>
                <p class="text-gray-500 mt-2">A comprehensive tool to estimate settlement outcomes.</p>
            </header>

            <div class="space-y-8">
                <!-- Case Details Section -->
                <section>
                    <h2 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-6">Case Details</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4">
                        <div>
                            <label for="grossSettlement" class="block text-sm font-medium text-gray-700 mb-1">Gross Settlement</label>
                            <div class="relative">
                                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                                <input id="grossSettlement" type="number" placeholder="20000" class="form-input w-full pl-7 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm">
                            </div>
                        </div>
                        <div>
                            <label for="demand" class="block text-sm font-medium text-gray-700 mb-1">Demand</label>
                            <div class="relative">
                                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                                <input id="demand" type="number" placeholder="40000" class="form-input w-full pl-7 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm">
                            </div>
                        </div>
                        <div>
                            <label for="offer" class="block text-sm font-medium text-gray-700 mb-1">Offer</label>
                            <div class="relative">
                                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                                <input id="offer" type="number" placeholder="20000" class="form-input w-full pl-7 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm">
                            </div>
                        </div>
                        <div class="bg-gray-50 p-3 rounded-lg flex justify-between items-center sm:col-start-2">
                            <span class="font-medium text-gray-600">Midpoint:</span>
                            <span id="midpointResult" class="font-bold text-gray-800 text-lg">$0.00</span>
                        </div>
                    </div>
                </section>

                <!-- Deductions Section -->
                <section>
                    <h2 class="text-xl font-semibold text-gray-700 border-b pb-2 mb-6">Deductions & Liens</h2>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-x-6 gap-y-4">
                         <div>
                            <label for="attorneyFee" class="block text-sm font-medium text-gray-700 mb-1">Attorney Fee</label>
                            <div class="relative">
                               <input type="number" id="attorneyFee" value="33.33" class="form-input w-full pl-4 pr-12 py-2 border border-gray-300 rounded-lg shadow-sm">
                               <span class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-500">%</span>
                           </div>
                        </div>
                        <div>
                            <label for="caseExpenses" class="block text-sm font-medium text-gray-700 mb-1">Case Expenses</label>
                             <div class="relative">
                                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                                <input id="caseExpenses" type="number" placeholder="500" class="form-input w-full pl-7 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm">
                            </div>
                        </div>
                        <div>
                            <label for="medicalBills" class="block text-sm font-medium text-gray-700 mb-1">Medical Bills (Balances)</label>
                             <div class="relative">
                                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                                <input id="medicalBills" type="number" placeholder="3948.50" class="form-input w-full pl-7 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm">
                            </div>
                        </div>
                        <div>
                            <label for="subro" class="block text-sm font-medium text-gray-700 mb-1">Subro</label>
                             <div class="relative">
                                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                                <input id="subro" type="number" placeholder="4816.34" class="form-input w-full pl-7 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm">
                            </div>
                        </div>
                        <div>
                            <label for="lopProvider" class="block text-sm font-medium text-gray-700 mb-1">LOP Provider</label>
                             <div class="relative">
                                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                                <input id="lopProvider" type="number" placeholder="5000" class="form-input w-full pl-7 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm">
                            </div>
                        </div>
                        <div>
                            <label for="loan" class="block text-sm font-medium text-gray-700 mb-1">Loan</label>
                             <div class="relative">
                                <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-500">$</span>
                                <input id="loan" type="number" placeholder="1000" class="form-input w-full pl-7 pr-4 py-2 border border-gray-300 rounded-lg shadow-sm">
                            </div>
                        </div>
                    </div>
                </section>
                
                <!-- Results Section -->
                <section id="results" class="space-y-4 pt-4 border-t border-gray-200">
                     <h2 class="text-xl font-semibold text-gray-800 text-center">Breakdown</h2>
                     <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
                        <span class="text-gray-600">Available Funds (Pre-Attorney):</span>
                        <span id="availableFundsResult" class="font-semibold text-gray-800 text-lg">$0.00</span>
                    </div>
                     <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
                        <div>
                            <span class="text-gray-600">Attorney's Fee Amount:</span>
                            <p id="attorneyFeeNote" class="text-xs text-green-600 font-medium hidden mt-1">Fee automatically reduced for client benefit.</p>
                            <p id="attorneyFeeReducedPercent" class="text-xs text-gray-500 font-medium hidden mt-1"></p>
                        </div>
                        <span id="attorneyFeeResult" class="font-semibold text-gray-800 text-lg">$0.00</span>
                    </div>
                    <div class="flex justify-between items-center bg-yellow-50 p-3 rounded-lg border border-yellow-200">
                        <span class="text-gray-600">Proposed LOP Reduction:</span>
                        <span id="proposedReductionResult" class="font-semibold text-yellow-800 text-lg">$0.00</span>
                    </div>
                     <div class="flex justify-between items-center bg-gray-50 p-3 rounded-lg">
                        <span class="text-gray-600">Total Deductions (Net):</span>
                        <span id="totalDeductionsResult" class="font-semibold text-gray-800 text-lg">$0.00</span>
                    </div>
                    <div class="bg-blue-600 text-white p-4 rounded-lg text-center mt-4 transition-colors duration-300" id="netToClientCard">
                        <span class="text-lg uppercase tracking-wider">Net To Client</span>
                        <p id="netToClientResult" class="text-4xl font-bold mt-1">$0.00</p>
                    </div>
                </section>

                 <!-- Reset Button -->
                <button id="resetButton" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-3 px-4 rounded-lg transition duration-300 ease-in-out mt-4">
                    Reset All Fields
                </button>
            </div>
        </div>
    </div>

    <script>
        // Input Elements
        const grossSettlementInput = document.getElementById('grossSettlement');
        const demandInput = document.getElementById('demand');
        const offerInput = document.getElementById('offer');
        const attorneyFeeInput = document.getElementById('attorneyFee');
        const caseExpensesInput = document.getElementById('caseExpenses');
        const medicalBillsInput = document.getElementById('medicalBills');
        const subroInput = document.getElementById('subro');
        const lopProviderInput = document.getElementById('lopProvider');
        const loanInput = document.getElementById('loan');

        // Result Elements
        const midpointResult = document.getElementById('midpointResult');
        const availableFundsResult = document.getElementById('availableFundsResult');
        const attorneyFeeResult = document.getElementById('attorneyFeeResult');
        const proposedReductionResult = document.getElementById('proposedReductionResult');
        const totalDeductionsResult = document.getElementById('totalDeductionsResult');
        const netToClientResult = document.getElementById('netToClientResult');
        const netToClientCard = document.getElementById('netToClientCard');

        const resetButton = document.getElementById('resetButton');

        const allInputs = [
            grossSettlementInput, demandInput, offerInput, attorneyFeeInput,
            caseExpensesInput, medicalBillsInput, subroInput, lopProviderInput, loanInput
        ];

        // Function to format numbers as US currency
        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD',
                minimumFractionDigits: 2,
            }).format(amount);
        }

        // Main calculation function
        function calculate() {
            // Get all values from inputs, defaulting to 0 if empty
            const grossSettlement = parseFloat(grossSettlementInput.value) || 0;
            const demand = parseFloat(demandInput.value) || 0;
            const offer = parseFloat(offerInput.value) || 0;
            const attorneyFeePercent = parseFloat(attorneyFeeInput.value) || 0;
            const caseExpenses = parseFloat(caseExpensesInput.value) || 0;
            const medicalBills = parseFloat(medicalBillsInput.value) || 0;
            const subro = parseFloat(subroInput.value) || 0;
            const lopProvider = parseFloat(lopProviderInput.value) || 0;
            const loan = parseFloat(loanInput.value) || 0;

            // Simple validation to prevent negative numbers in calculation
            if ([grossSettlement, demand, offer, attorneyFeePercent, caseExpenses, medicalBills, subro, lopProvider, loan].some(v => v < 0)) {
                return;
            }

            // Perform calculations based on the new spreadsheet logic
            const midpoint = (demand + offer) / 2;
            const availableFunds = grossSettlement - caseExpenses - medicalBills - subro;
            
            // Calculate Proposed Reduction using an updated formula to match the example.
            let proposedReduction = 0;
            const otherMedicalBills = medicalBills + subro;
            const formulaDenominator = (grossSettlement * 0.8) + lopProvider;
            if (formulaDenominator > 0) {
                 proposedReduction = (otherMedicalBills / formulaDenominator) * lopProvider;
            }
            proposedReduction = Math.max(0, Math.min(lopProvider, proposedReduction));

            // All deductions EXCEPT attorney fee and the loan
            const otherDeductions = caseExpenses + medicalBills + subro + lopProvider - proposedReduction;

            // Calculate initial attorney fee
            let attorneyFeeAmount = grossSettlement * (attorneyFeePercent / 100);
            // This is the client's share BEFORE their personal loan is deducted
            let netToClientPreLoan = grossSettlement - attorneyFeeAmount - otherDeductions;

            const attorneyFeeNote = document.getElementById('attorneyFeeNote');
            const attorneyFeeReducedPercent = document.getElementById('attorneyFeeReducedPercent');

            // Check if client gets less than the firm (before the loan is factored in)
            if (netToClientPreLoan < attorneyFeeAmount) {
                // If so, reduce the attorney's fee so both get an equal amount
                // of what's left after other deductions are paid.
                const fundsToSplit = grossSettlement - otherDeductions;
                attorneyFeeAmount = Math.max(0, fundsToSplit / 2); // Ensure it doesn't go negative
                netToClientPreLoan = Math.max(0, fundsToSplit / 2); // Client's share before loan
                
                let reducedPercent = 0;
                if (grossSettlement > 0) {
                    reducedPercent = (attorneyFeeAmount / grossSettlement) * 100;
                }
                attorneyFeeReducedPercent.textContent = `(Effective Rate: ${reducedPercent.toFixed(2)}%)`;

                attorneyFeeNote.classList.remove('hidden');
                attorneyFeeReducedPercent.classList.remove('hidden');
            } else {
                attorneyFeeNote.classList.add('hidden');
                attorneyFeeReducedPercent.classList.add('hidden');
            }

            // Now, calculate the final net to client by subtracting the loan from their share
            const netToClient = netToClientPreLoan - loan;

            // Calculate final totals with the potentially adjusted attorney fee and the loan
            const totalDeductions = attorneyFeeAmount + otherDeductions + loan;

            // Update the display with formatted values
            midpointResult.textContent = formatCurrency(midpoint);
            availableFundsResult.textContent = formatCurrency(availableFunds);
            attorneyFeeResult.textContent = formatCurrency(attorneyFeeAmount);
            proposedReductionResult.textContent = formatCurrency(proposedReduction);
            totalDeductionsResult.textContent = formatCurrency(totalDeductions);
            netToClientResult.textContent = formatCurrency(netToClient);

            // Change the result card color to red if the net amount is negative
            if (netToClient < 0) {
                netToClientCard.classList.remove('bg-blue-600');
                netToClientCard.classList.add('bg-red-600');
            } else {
                netToClientCard.classList.add('bg-blue-600');
                netToClientCard.classList.remove('bg-red-600');
            }
        }

        // Function to reset all fields to their default state
        function reset() {
            allInputs.forEach(input => {
                // Check if the input is not the attorney fee percentage before clearing
                if (input.id !== 'attorneyFee') {
                    input.value = '';
                }
            });
            attorneyFeeInput.value = '33.33'; // Set attorney fee back to default
            calculate();
        }

        // Add event listeners to all inputs to calculate in real-time
        allInputs.forEach(input => {
            input.addEventListener('input', calculate);
        });

        resetButton.addEventListener('click', reset);

        // Perform an initial calculation when the page loads
        calculate();
    </script>
</body>
</html>
